/**
 * PhysicsJS v0.5.3 - 2013-11-25
 * A modular, extendable, and easy-to-use physics engine for javascript
 * http://wellcaffeinated.net/PhysicsJS
 *
 * Copyright (c) 2013 Jasper Palfree <jasper@wellcaffeinated.net>
 * Licensed MIT
 */

(function(e,t){var n=["physicsjs"];if(typeof exports=="object"){var r=n.map(require);module.exports=t.call(e,r[0])}else typeof define=="function"&&define.amd?define(n,function(n){return t.call(e,n)}):e.Physics=t.call(e,e.Physics)})(this,function(e){return e.renderer("canvas",function(t){var n=Math.PI*2,r=function(e,t){var n=document.createElement(e||"div");return t&&(n.innerHTML=t),n},i={debug:!1,metaEl:null,styles:{point:"rgba(80, 50, 100, 0.7)",circle:{strokeStyle:"rgba(70, 50, 100, 0.7)",lineWidth:1,fillStyle:"rgba(44, 105, 44, 0.7)",angleIndicator:"rgba(69, 51, 78, 0.7)"},"convex-polygon":{strokeStyle:"rgba(80, 50, 100, 0.7)",lineWidth:1,fillStyle:"rgba(114, 105, 124, 0.7)",angleIndicator:"rgba(69, 51, 78, 0.7)"}},offset:{x:0,y:0}},s=function(t,n){return e.util.isPlainObject(n)?e.util.extend({},t,n,s):n!==undefined?n:t};return{init:function(n){t.init.call(this,n),this.options=e.util.extend({},i,this.options,s),this.options.offset=e.vector(this.options.offset),this.hiddenCanvas=document.createElement("canvas"),this.hiddenCanvas.width=this.hiddenCanvas.height=100;if(!this.hiddenCanvas.getContext)throw"Canvas not supported";this.hiddenCtx=this.hiddenCanvas.getContext("2d");var o=this.el;o.nodeName.toUpperCase()!=="CANVAS"&&(o=document.createElement("canvas"),this.el.appendChild(o),typeof this.options.el=="string"&&this.el===document.body&&(o.id=this.options.el),this.el=o),o.width=this.options.width,o.height=this.options.height,this.ctx=o.getContext("2d"),this.els={};if(this.options.meta){var u=this.options.metaEl||r();u.className="pjs-meta",this.els.fps=r("span"),this.els.ipf=r("span"),u.appendChild(r("span","fps: ")),u.appendChild(this.els.fps),u.appendChild(r("br")),u.appendChild(r("span","ipf: ")),u.appendChild(this.els.ipf),o.parentNode.insertBefore(u,o)}},setStyle:function(t,n){n=n||this.ctx,e.util.isObject(t)?(n.strokeStyle=t.strokeStyle,n.fillStyle=t.fillStyle,n.lineWidth=t.lineWidth):(n.fillStyle=n.strokeStyle=t,n.lineWidth=1)},drawCircle:function(e,t,r,i,s){s=s||this.ctx,s.beginPath(),this.setStyle(i,s),s.arc(e,t,r,0,n,!1),s.closePath(),s.stroke(),s.fill()},drawPolygon:function(e,t,n){var r=e[0],i=r.x===undefined?r.get(0):r.x,s=r.y===undefined?r.get(1):r.y,o=e.length;n=n||this.ctx,n.beginPath(),this.setStyle(t,n),n.moveTo(i,s);for(var u=1;u<o;++u)r=e[u],i=r.x===undefined?r.get(0):r.x,s=r.y===undefined?r.get(1):r.y,n.lineTo(i,s);o>2&&n.closePath(),n.stroke(),n.fill()},drawLine:function(e,t,n,r){var i=e.x===undefined?e.get(0):e.x,s=e.y===undefined?e.get(1):e.y;r=r||this.ctx,r.beginPath(),this.setStyle(n,r),r.moveTo(i,s),i=t.x===undefined?t.get(0):t.x,s=t.y===undefined?t.get(1):t.y,r.lineTo(i,s),r.stroke(),r.fill()},createView:function(e,t){var n=new Image,r=e.aabb(),i=r.halfWidth+Math.abs(r.pos.x),s=r.halfHeight+Math.abs(r.pos.y),o=i+1,u=s+1,a=this.hiddenCtx,f=this.hiddenCanvas,l=e.name;return t=t||this.options.styles[l],o+=t.lineWidth|0,u+=t.lineWidth|0,f.width=2*i+2+(2*t.lineWidth|0),f.height=2*s+2+(2*t.lineWidth|0),a.save(),a.translate(o,u),l==="circle"?this.drawCircle(0,0,e.radius,t,a):l==="convex-polygon"&&this.drawPolygon(e.vertices,t,a),t.angleIndicator&&(a.beginPath(),this.setStyle(t.angleIndicator,a),a.moveTo(0,0),a.lineTo(i,0),a.closePath(),a.stroke()),a.restore(),n.src=f.toDataURL("image/png"),n.width=f.width,n.height=f.height,n},drawMeta:function(e){this.els.fps.innerHTML=e.fps.toFixed(2),this.els.ipf.innerHTML=e.ipf},beforeRender:function(){this.ctx.clearRect(0,0,this.el.width,this.el.height)},drawBody:function(e,t){var n=this.ctx,r=e.state.pos,i=this.options.offset,s=e.aabb();n.save(),n.translate(r.get(0)+i.get(0),r.get(1)+i.get(1)),n.rotate(e.state.angular.pos),n.drawImage(t,-t.width/2,-t.height/2),n.restore(),this.options.debug&&(n.save(),n.translate(i.get(0),i.get(1)),this.drawPolygon([{x:s.pos.x-s.x,y:s.pos.y-s.y},{x:s.pos.x+s.x,y:s.pos.y-s.y},{x:s.pos.x+s.x,y:s.pos.y+s.y},{x:s.pos.x-s.x,y:s.pos.y+s.y}],"rgba(100, 255, 100, 0.3)"),n.restore())}}}),e});